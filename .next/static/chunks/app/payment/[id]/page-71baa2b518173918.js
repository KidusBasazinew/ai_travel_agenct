(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5142],{3615:function(e,t,r){Promise.resolve().then(r.bind(r,6146))},6146:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s=r(5193),a=r(1461),n=r(1876),l=r(1501),i=r(2310);let c=(0,l.J)("pk_test_51QL2xhRq4rJ56yAKKvaK6ixNdRVJ1sbotKvof63tv6aswI947ZIwucLBOCYZzvIGL2dnZIchNxbZuNKVPq4a0Ypq00qwiKxzDx"),o={style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}},d=e=>{let{tripId:t,price:r}=e,a=(0,n.useStripe)(),l=(0,n.useElements)(),[c,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(""),[x,h]=(0,i.useState)(!1),f=async e=>{if(e.preventDefault(),d(!0),m(""),!a||!l){m("Payment system not initialized"),d(!1);return}try{h(!0);let{error:e,paymentMethod:s}=await a.createPaymentMethod({type:"card",card:l.getElement(n.CardElement)});if(e)switch(e.type){case"card_error":throw Error(e.message);case"validation_error":throw Error("Please check your card details");default:throw Error("An unexpected error occurred")}let i=await fetch("/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:100*r,currency:"usd",tripId:t,paymentMethodId:s.id})});if(!i.ok){let e=await i.json();throw Error(e.error||"Payment failed")}let{clientSecret:c}=await i.json(),{error:o}=await a.confirmCardPayment(c);if(o)throw o;window.location.href="/payment/".concat(t,"/success")}catch(e){m(e instanceof Error?e.message:"Payment failed. Please try again."),console.error("Payment error:",e)}finally{d(!1),h(!1)}};return(0,s.jsx)("div",{className:"w-full max-w-3xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:(0,s.jsxs)("form",{onSubmit:f,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Card Details"}),(0,s.jsx)("div",{className:"p-4 border rounded-lg",children:(0,s.jsx)(n.CardElement,{options:o})})]}),(0,s.jsx)("button",{type:"submit",disabled:!a||c||x,className:"w-full py-3 px-4 rounded-md text-white font-medium ".concat(!a||c||x?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:x?(0,s.jsxs)("span",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):c?"Loading...":"Pay $".concat(r)}),u&&(0,s.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,s.jsx)("p",{className:"text-sm text-red-600",children:u})})]})})};function u(e){let{tripId:t,price:r}=e,[a,l]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{c.then(()=>l(!0))},[]),a)?(0,s.jsx)(n.Elements,{stripe:c,children:(0,s.jsx)(d,{tripId:t,price:r})}):(0,s.jsx)("div",{className:"w-full flex items-center justify-center p-6",children:(0,s.jsx)("div",{className:"animate-pulse flex space-x-4",children:(0,s.jsxs)("div",{className:"flex-1 space-y-4 py-1",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})})})}var m=r(4477),x=r(8367);function h(e){let t,{params:r}=e,[n,l]=(0,i.useState)(null),[c,o]=(0,i.useState)(null);if((0,i.useEffect)(()=>{(async()=>{try{let e=await (0,a.s)(r.id);if(!e)throw Error("Trip not found");l(e)}catch(e){o(e instanceof Error?e.message:"Failed to fetch trip")}})()},[r.id]),c)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("p",{className:"text-red-500",children:c})});if(!n)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("p",{children:"Loading..."})});try{if(!(t=(0,m.c_)(n.tripDetails)))throw Error("Failed to parse trip details")}catch(e){return console.error(e),(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("p",{className:"text-red-500",children:"Failed to parse trip details"})})}return(0,s.jsxs)("div",{className:"flex flex-col md:flex-row min-h-screen px-4 md:px-16 py-8 gap-10 bg-white",children:[(0,s.jsxs)("section",{className:"w-full md:w-1/2 flex flex-col justify-center items-start px-6 md:px-12 lg:px-20 py-8 bg-white gap-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(x.default,{src:"/assets/icons/logo.svg",width:32,height:32,alt:"logo",className:"size-8"}),(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-800",children:"Tourvisto"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Pay ",t.name,": ",t.interests,", ",t.travelStyle]}),(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:t.estimatedPrice})]}),(0,s.jsx)(x.default,{src:n.imageUrls[0],width:500,height:300,alt:t.name,className:"rounded-lg object-cover w-full max-w-sm h-48"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:t.name}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:[t.interests,", ",t.travelStyle]})]}),(0,s.jsxs)("div",{className:"mt-10 flex gap-4 items-center text-xs text-gray-400",children:[(0,s.jsxs)("span",{children:["Powered by ",(0,s.jsx)("strong",{className:"text-gray-600",children:"Stripe"})]}),(0,s.jsx)("span",{className:"h-4 border-l border-gray-300"}),(0,s.jsx)("a",{href:"#",className:"hover:underline",children:"Terms"}),(0,s.jsx)("a",{href:"#",className:"hover:underline",children:"Privacy"})]})]}),(0,s.jsx)("section",{className:"w-full md:w-1/2 flex justify-center items-center",children:(0,s.jsx)("div",{className:"w-full max-w-md bg-white p-6 shadow-md rounded-lg",children:(0,s.jsx)(u,{tripId:r.id,price:Number(t.estimatedPrice)})})})]})}},568:function(e,t,r){"use strict";r.d(t,{Fs:function(){return i},JT:function(){return l},qA:function(){return a}});var s=r(2289);let a={endpointUrl:"https://fra.cloud.appwrite.io/v1",projectId:"6814b4380013a9b2410d",apiKey:"6814b4380013a9b2410d",databaseId:"6814b52c000b72ebe3de",userCollectionId:"6814b5420024dcd92e84",tripCollectionId:"6814b56000150e453129"},n=new s.KU().setEndpoint(a.endpointUrl).setProject(a.projectId),l=new s.mR(n),i=new s.Lg(n);new s.Ke(n)},1461:function(e,t,r){"use strict";r.d(t,{B:function(){return n},s:function(){return l}});var s=r(568),a=r(2289);let n=async(e,t)=>{let r=await s.Fs.listDocuments(s.qA.databaseId,s.qA.tripCollectionId,[a.AE.limit(e),a.AE.offset(t),a.AE.orderDesc("createdAt")]);return 0===r.total?(console.error("No trips found"),{allTrips:[],total:0}):{allTrips:r.documents,total:r.total}},l=async e=>{let t=await s.Fs.getDocument(s.qA.databaseId,s.qA.tripCollectionId,e);return t.$id?t:(console.log("Trip not found"),null)}},4477:function(e,t,r){"use strict";r.d(t,{Ew:function(){return m},c_:function(){return o},cn:function(){return i},gr:function(){return d},jd:function(){return u},p6:function(){return c}});var s=r(4848),a=r(9998),n=r(3676),l=r.n(n);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}let c=e=>l()(e).format("MMMM DD, YYYY");function o(e){try{return JSON.parse(e)}catch(e){return console.error("Failed to parse trip data:",e),null}}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.trim().split(/\s+/)[0]||""}let u=(e,t)=>{if(0===t)return 0===e?{trend:"no change",percentage:0}:{trend:"increment",percentage:100};let r=e-t,s=Math.abs(r/t*100);return r>0?{trend:"increment",percentage:s}:r<0?{trend:"decrement",percentage:s}:{trend:"no change",percentage:0}},m=e=>e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}},function(e){e.O(0,[3612,9276,9447,3044,7550,1744],function(){return e(e.s=3615)}),_N_E=e.O()}]);